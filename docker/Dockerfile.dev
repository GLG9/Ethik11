FROM node:20-bookworm

# Install Python tooling required by start-dev.sh
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        python3 \
        python3-venv \
        python3-pip \
    && rm -rf /var/lib/apt/lists/*

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /workspace

# Preinstall backend dependencies to seed the named volume
COPY backend/requirements.txt backend/requirements.txt
RUN python3 -m venv backend/.venv \
    && backend/.venv/bin/pip install --upgrade pip \
    && backend/.venv/bin/pip install -r backend/requirements.txt

# Preinstall frontend dependencies to seed the named volume
COPY frontend/web/package.json frontend/web/package-lock.json frontend/web/
# (optional) npm im Image an deinen Host angleichen
RUN npm i -g npm@11
# FÃ¼r Dev-Container toleranter als 'ci'
RUN cd frontend/web && npm install

# Copy project files
COPY . .

EXPOSE 3000 4200

CMD ["./start-dev.sh"]
